2025-10-17 16:32:18 | INFO     | Log iniciado: logs\etl_20251017_163218.log
2025-10-17 16:32:18 | INFO     | Nível de log: INFO
2025-10-17 16:32:18 | INFO     | ======================================================================
2025-10-17 16:32:18 | INFO     | 
2025-10-17 16:32:18 | INFO     | ======================================================================
2025-10-17 16:32:18 | INFO     | ETAPA: ANÁLISE DE VENDAS E DISTRIBUIÇÃO DE METAS COM APACHE SPARK
2025-10-17 16:32:18 | INFO     | ======================================================================
2025-10-17 16:32:18 | INFO     | Data de execução: 2025-10-17 16:32:18
2025-10-17 16:32:18 | INFO     | Criando Spark Session...
2025-10-17 16:32:28 | INFO     | ✓ Spark Session criada com sucesso
2025-10-17 16:32:28 | INFO     | 
2025-10-17 16:32:28 | INFO     | ======================================================================
2025-10-17 16:32:28 | INFO     | ETAPA: CARREGAMENTO DE DADOS (100% PySpark)
2025-10-17 16:32:28 | INFO     | ======================================================================
2025-10-17 16:32:28 | INFO     | Carregando dados de vendas: C:\Users\matheus.rodrigues\Downloads\Case\input\sales.csv
2025-10-17 16:32:36 | INFO     | → df_sales (100% PySpark): 28,884 registros
2025-10-17 16:32:36 | INFO     | Carregando arquivo de metas: C:\Users\matheus.rodrigues\Downloads\Case\input\metas por marca.csv
2025-10-17 16:32:37 | INFO     | → df_metas: 20 registros
2025-10-17 16:32:37 | INFO     | 
2025-10-17 16:32:37 | INFO     | ======================================================================
2025-10-17 16:32:37 | INFO     | ETAPA: EXPLORAÇÃO DOS DADOS
2025-10-17 16:32:37 | INFO     | ======================================================================
2025-10-17 16:32:37 | INFO     | ESTRUTURA DO ARQUIVO DE VENDAS
2025-10-17 16:32:37 | INFO     | ESTATÍSTICAS DESCRITIVAS - VENDAS
2025-10-17 16:32:41 | INFO     | AMOSTRA DOS DADOS DE VENDAS (5 registros)
2025-10-17 16:32:41 | INFO     | CONTAGEM DE REGISTROS POR COLUNA
2025-10-17 16:32:42 | INFO     | Código do Cliente             :   28884 não-nulos |       0 nulos (0.00%)
2025-10-17 16:32:43 | INFO     | cod material                  :   28884 não-nulos |       0 nulos (0.00%)
2025-10-17 16:32:43 | WARNING  | b2b_status                    :   28853 não-nulos |      31 nulos (0.11%)
2025-10-17 16:32:44 | INFO     | volume_hl                     :   28884 não-nulos |       0 nulos (0.00%)
2025-10-17 16:32:44 | INFO     | valor                         :   28884 não-nulos |       0 nulos (0.00%)
2025-10-17 16:32:45 | INFO     | data_doc                      :   28884 não-nulos |       0 nulos (0.00%)
2025-10-17 16:32:45 | WARNING  | materialPackaging             :   28861 não-nulos |      23 nulos (0.08%)
2025-10-17 16:32:46 | WARNING  | brand                         :   28861 não-nulos |      23 nulos (0.08%)
2025-10-17 16:32:46 | WARNING  | brand_desc                    :   28606 não-nulos |     278 nulos (0.96%)
2025-10-17 16:32:47 | WARNING  | material                      :   28606 não-nulos |     278 nulos (0.96%)
2025-10-17 16:32:47 | INFO     | CEP_cliente                   :   28884 não-nulos |       0 nulos (0.00%)
2025-10-17 16:32:47 | INFO     | ESTRUTURA DO ARQUIVO DE METAS
2025-10-17 16:32:47 | INFO     | DADOS DE METAS
2025-10-17 16:32:47 | INFO     | 
2025-10-17 16:32:47 | INFO     | ======================================================================
2025-10-17 16:32:47 | INFO     | ETAPA: LIMPEZA E PREPARAÇÃO DOS DADOS
2025-10-17 16:32:47 | INFO     | ======================================================================
2025-10-17 16:32:47 | INFO     | Coluna data_doc convertida para DateType
2025-10-17 16:32:47 | INFO     | Tratamento de valores ausentes:
2025-10-17 16:32:49 | WARNING  | materialPackaging: 23 valores nulos preenchidos com 0
2025-10-17 16:32:49 | WARNING  | brand: 23 valores nulos preenchidos com 0
2025-10-17 16:32:50 | WARNING  | b2b_status: 31 valores nulos preenchidos com False
2025-10-17 16:32:50 | WARNING  | brand_desc: 278 valores nulos preenchidos
2025-10-17 16:32:50 | WARNING  | material: 278 valores nulos preenchidos
2025-10-17 16:32:50 | INFO     | ✓ Limpeza concluída: 28884 registros preparados
2025-10-17 16:32:50 | INFO     | 
2025-10-17 16:32:50 | INFO     | ======================================================================
2025-10-17 16:32:50 | INFO     | ETAPA: CRIAÇÃO DO MODELO DIMENSIONAL (STAR SCHEMA)
2025-10-17 16:32:50 | INFO     | ======================================================================
2025-10-17 16:32:50 | INFO     | Criando dim_cliente...
2025-10-17 16:32:52 | INFO     | → dim_cliente: 58 registros
2025-10-17 16:32:52 | INFO     | Criando dim_produto...
2025-10-17 16:32:54 | INFO     | → dim_produto: 27 registros
2025-10-17 16:32:54 | INFO     | Criando fato_vendas...
2025-10-17 16:32:56 | INFO     | → fato_vendas: 28,884 registros
2025-10-17 16:32:56 | INFO     | ✓ Modelo dimensional criado com sucesso!
2025-10-17 16:32:56 | INFO     | 
2025-10-17 16:32:56 | INFO     | ======================================================================
2025-10-17 16:32:56 | INFO     | ETAPA: CRIAÇÃO DA VISÃO CONSOLIDADA POR CLIENTE
2025-10-17 16:32:56 | INFO     | ======================================================================
2025-10-17 16:32:56 | INFO     | Identificando última compra de cada cliente...
2025-10-17 16:32:56 | INFO     | Agregando dados por cliente e mês...
2025-10-17 16:32:56 | INFO     | Calculando métricas rolling (3 e 6 meses)...
2025-10-17 16:32:56 | INFO     | Consolidando visão final por cliente...
2025-10-17 16:33:11 | INFO     | ✓ Visão consolidada criada: 58 clientes
2025-10-17 16:33:11 | INFO     | AMOSTRA DA VISÃO CONSOLIDADA
2025-10-17 16:33:20 | INFO     | 
2025-10-17 16:33:20 | INFO     | ======================================================================
2025-10-17 16:33:20 | INFO     | ETAPA: DISTRIBUIÇÃO DE METAS POR CLIENTE - ANO 2025
2025-10-17 16:33:20 | INFO     | ======================================================================
2025-10-17 16:33:20 | INFO     | Filtrando metas do ano 2025...
2025-10-17 16:33:20 | INFO     | → metas_2025: 10 registros
2025-10-17 16:33:20 | INFO     | Calculando volume por cliente e marca...
2025-10-17 16:33:20 | INFO     | Calculando volume total por marca...
2025-10-17 16:33:20 | INFO     | Calculando participação percentual de cada cliente...
2025-10-17 16:33:20 | INFO     | Distribuindo metas proporcionalmente...
2025-10-17 16:33:25 | INFO     | ✓ Metas distribuídas: 325 registros (cliente x marca)
2025-10-17 16:33:25 | INFO     | AMOSTRA DAS METAS DISTRIBUÍDAS
2025-10-17 16:33:31 | INFO     | VALIDAÇÃO: Comparação entre Meta da Marca e Soma das Metas dos Clientes
2025-10-17 16:33:50 | WARNING  | ATENÇÃO: 8 marcas com diferença entre meta e soma das metas dos clientes
2025-10-17 16:33:50 | INFO     | 
2025-10-17 16:33:50 | INFO     | ======================================================================
2025-10-17 16:33:50 | INFO     | ETAPA: ENRIQUECIMENTO DE DADOS VIA API DE CEP
2025-10-17 16:33:50 | INFO     | ======================================================================
2025-10-17 16:33:50 | WARNING  | Coluna 'cep' não encontrada, assumindo que DataFrame tem 'cliente_id'
2025-10-17 16:33:50 | WARNING  | Enriquecimento CEP pulado (coluna 'cep' não disponível)
2025-10-17 16:33:50 | INFO     | 
2025-10-17 16:33:50 | INFO     | ======================================================================
2025-10-17 16:33:50 | INFO     | ETAPA: ENRIQUECIMENTO DE DADOS VIA API DE CEP
2025-10-17 16:33:50 | INFO     | ======================================================================
2025-10-17 16:33:50 | WARNING  | Coluna 'cep' não encontrada, assumindo que DataFrame tem 'cliente_id'
2025-10-17 16:33:50 | WARNING  | Enriquecimento CEP pulado (coluna 'cep' não disponível)
2025-10-17 16:33:50 | INFO     | 
2025-10-17 16:33:50 | INFO     | ======================================================================
2025-10-17 16:33:50 | INFO     | ETAPA: EXPORTAÇÃO DE RESULTADOS
2025-10-17 16:33:50 | INFO     | ======================================================================
2025-10-17 16:33:50 | INFO     | Exportando visao_consolidada...
2025-10-17 16:33:59 | WARNING  | Spark write falhou (falta winutils no Windows), usando Pandas para salvar...
2025-10-17 16:34:09 | INFO     | CSV (via Pandas): C:\Users\matheus.rodrigues\Downloads\Case\output\csv\visao_consolidada.csv
2025-10-17 16:34:16 | WARNING  | Spark parquet falhou, usando Pandas...
2025-10-17 16:34:17 | INFO     | Parquet (via Pandas): C:\Users\matheus.rodrigues\Downloads\Case\output\parquet\visao_consolidada.parquet
2025-10-17 16:34:17 | INFO     | Exportando metas_por_cliente...
2025-10-17 16:34:27 | WARNING  | Spark write falhou (falta winutils no Windows), usando Pandas para salvar...
2025-10-17 16:34:36 | INFO     | CSV (via Pandas): C:\Users\matheus.rodrigues\Downloads\Case\output\csv\metas_por_cliente.csv
2025-10-17 16:34:44 | WARNING  | Spark parquet falhou, usando Pandas...
2025-10-17 16:34:44 | INFO     | Parquet (via Pandas): C:\Users\matheus.rodrigues\Downloads\Case\output\parquet\metas_por_cliente.parquet
2025-10-17 16:34:44 | INFO     | Exportando dim_cliente...
2025-10-17 16:34:46 | WARNING  | Spark write falhou (falta winutils no Windows), usando Pandas para salvar...
2025-10-17 16:34:47 | INFO     | CSV (via Pandas): C:\Users\matheus.rodrigues\Downloads\Case\output\csv\dim_cliente.csv
2025-10-17 16:34:48 | WARNING  | Spark parquet falhou, usando Pandas...
2025-10-17 16:34:49 | INFO     | Parquet (via Pandas): C:\Users\matheus.rodrigues\Downloads\Case\output\parquet\dim_cliente.parquet
2025-10-17 16:34:49 | INFO     | Exportando fato_vendas...
2025-10-17 16:34:50 | WARNING  | Spark write falhou (falta winutils no Windows), usando Pandas para salvar...
2025-10-17 16:34:52 | INFO     | CSV (via Pandas): C:\Users\matheus.rodrigues\Downloads\Case\output\csv\fato_vendas.csv
2025-10-17 16:34:54 | WARNING  | Spark parquet falhou, usando Pandas...
2025-10-17 16:34:54 | INFO     | Parquet (via Pandas): C:\Users\matheus.rodrigues\Downloads\Case\output\parquet\fato_vendas.parquet
2025-10-17 16:34:54 | INFO     | Exportando dim_produto...
2025-10-17 16:34:55 | WARNING  | Spark write falhou (falta winutils no Windows), usando Pandas para salvar...
2025-10-17 16:34:56 | INFO     | CSV (via Pandas): C:\Users\matheus.rodrigues\Downloads\Case\output\csv\dim_produto.csv
2025-10-17 16:34:57 | WARNING  | Spark parquet falhou, usando Pandas...
2025-10-17 16:34:57 | INFO     | Parquet (via Pandas): C:\Users\matheus.rodrigues\Downloads\Case\output\parquet\dim_produto.parquet
2025-10-17 16:34:57 | INFO     | ✓ Todas as exportações concluídas!
2025-10-17 16:34:57 | INFO     | 
2025-10-17 16:34:57 | INFO     | ======================================================================
2025-10-17 16:34:57 | INFO     | ETAPA: PROCESSAMENTO CONCLUÍDO COM SUCESSO!
2025-10-17 16:34:57 | INFO     | ======================================================================
2025-10-17 16:34:57 | INFO     | Resultados salvos em: C:\Users\matheus.rodrigues\Downloads\Case\output
2025-10-17 16:34:57 | INFO     | 
Arquivos gerados:
2025-10-17 16:34:57 | INFO     |   • visao_consolidada: Métricas consolidadas por cliente
2025-10-17 16:34:57 | INFO     |   • metas_por_cliente: Metas distribuídas por cliente e marca
2025-10-17 16:34:57 | INFO     |   • dim_cliente: Dimensão de clientes
2025-10-17 16:34:57 | INFO     |   • dim_produto: Dimensão de produtos/marcas
2025-10-17 16:34:57 | INFO     |   • dim_tempo: Dimensão de tempo
2025-10-17 16:34:57 | INFO     |   • fato_vendas: Fato de vendas (star schema)
2025-10-17 16:34:57 | INFO     | 
2025-10-17 16:34:57 | INFO     | ======================================================================
2025-10-17 16:34:57 | INFO     | ETL FINALIZADO
2025-10-17 16:34:57 | INFO     | Tempo total: 0:02:39.018729
2025-10-17 16:34:57 | INFO     | Log salvo em: logs\etl_20251017_163218.log
2025-10-17 16:34:57 | INFO     | ======================================================================
2025-10-17 16:34:59 | INFO     | Sessão Spark encerrada
